<!DOCTYPE html>
<html>
<head>
	<title>DroneCast</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type='text/javascript' src='config.js'></script>
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
	<header>
		<h1>DroneCast AZ</h1>
	</header>

	<div class="first">
		<!--<h3>Enter a city to find current weather conditions.</h3>
		<label for="city">City: </label>
		<input type="text" name="city" id="city"><br>
	-->
		<br><label for="location">Select a Drone Park: </label><br>
		<select name="location" id="location">
			<option value="Gilbert">Freestone Park</option>
			<option value="Phoenix">Coyote Basin Park</option>
			<option value="Cave Creek">Dynamite Park</option>
			<option value="Mesa">City of Mesa Retention Basin #116</option>
			<option value="Goodyear">Estrella Mountain Regional Park</option>

		</select><br>

		<button id="search" name="search" onclick="getWeather()">Search</button><br>
	</div>

	<div id="second">
		<p id="weather">Weather conditions will appear here.</p>
		<p id="description"></p>
		<p id="wind"></p>
		<p id="wind_deg"></p>
	</div>

	<script type="text/javascript">
		function getWeather(){
			//const api_key = '5dd7d13462ea2b7ba5176cd85add7658';
			const api_key = '<%= process.env.API_KEY %>';
			var city = document.getElementById("location").value;
			console.log("Beginning weather search in " + city);

			var url = 'https://api.openweathermap.org/data/2.5/weather?q=' + city + '&units=imperial' + '&appid=' + api_key;
			console.log("The API URL is "+ url);

			fetch(url).then(response => {
				console.log(response);
				return response.json();
			}).then(response => {
				console.log(response);
				document.getElementById('weather').innerHTML = "Current Temp: " + response.main.temp;
				document.getElementById('description').innerHTML = "Description: " + response.weather[0].description;
				document.getElementById('wind').innerHTML = "Wind Speed: " + response.wind.speed;
				document.getElementById('wind_deg').innerHTML = "Wind Degree: " + response.wind.deg;
				//document.getElementById('second').innerHTML = JSON.stringify(response);
			}).catch(error => {
				console.error(error);
			});
		}
	</script>
</body>
</html>